<div class = "row">
  <h2>Regional MOM6 Data Access</h2>
  <div class="alert alert-warning" role="alert">
    <!-- Forced refresh for getting the newest data server status -->
    <a class="refresh-link" onclick="location.reload(true);"><strong>Press</strong></a> to get latest data server status &#x27A0;
    <!-- Using api to refresh status badge (need to implement when the tab is not in active dev) -->
    <!-- <img alt="OPeNDAP Badge" src="https://img.shields.io/badge/OPeNDAP_server-available-blue?style=flat"> -->
    <!-- Forced refresh for getting the newest data server status -->
    <a class="refresh-link" onclick="location.reload(true);"><img src="img/opendap_status.png" alt="OPeNDAP statusBadge"></a>
  </div>

  <div class="alert alert-success" role="alert">
    &#10024; If you want to request variables that currently not available, please complete the <a href="#" class="alert-link" data-toggle="modal" data-target="#ModalVariableRequest">request form</a>! &#10024;
  </div>
  <div class="col-12">
    <p>
      Currently, the regional MOM6 output can be accessed through the PSL THREDDS server.
      Users have the flexibility to choose their preferred method of data retrieval from this server.
      Additionally, an alternative option involving AWS cloud storage is under consideration and may become available in the near future.
      This option is currently undergoing testing.
      For direct access to the THREDDS server, 
      <a href="https://psl.noaa.gov/thredds/catalog/Projects/CEFI/regional_mom6/cefi_portal/catalog.html" target="_blank">
        <u> go to the <strong>catalog</strong> directly</u>
      </a>
      .
    </p>
  </div>
  <hr class="dot-hr-plot">
  <h3>CEFI directory and filename convention</h3>
    <div class="panel-group" id="accordion">
        <!-- expanding panel -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse0">
                <i class="fas fa-plus-circle"></i> CEFI directory structure</a>
                </h4>
            </div>

            <div id="collapse0" class="panel-collapse collapse">
                <div class="panel-body">
                    <p>
                      The CEFI directory structure is designed to facilitate easy navigation and clearly separates different experiment types conducted by various modeling and application teams.
                      The structure is organized hierarchically, starting from the top-level directory.

                    </p>

                    <pre><code class="codeBlockScroll"> &ltregion&gt/&ltsubdomain&gt/&ltexperiment_type&gt/&ltoutput_frequency&gt/&ltgrid_type&gt/&ltrelease&gt/</code></pre>
                    <hr class="dot-hr-plot">
                    <p>
                      <ul>
                        <li>
                          <code> &ltregion&gt </code>:
                        
                          [directory name / filename abbreviation]
                          
                          <ul>
                            <li><code>northwest_atlantic / nwa</code></li>
                            <li><code>northeast_pacific / nep </code></li> 
                            <li><code>arctic / arc</code></li>  
                            <li><code>pacific_islands / pci</code></li>
                            <li><code>great_lakes / glk</code></li>
                            <li>…etc</li>
                          </ul>
                        </li>
  
                        <li>
                          <code> &ltsubdomain&gt </code>:
  
                          [directory name / filename abbreviation]
    
                          <ul>
                            <li><code>full_domain / full</code></li>
                            <li>…etc</li>
                          </ul>
                        </li>
                        
                        <li>
                          <code> &ltexperiment_type&gt </code>:
  
                          [directory name / filename abbreviation]
    
                          <ul>
                            <li><code>hindcast / hcast</code></li>
                            <li><code>seasonal_forecast / ss_fcast</code></li>
                            <li><code>seasonal_forecast_initialization / ss_fcast_init</code></li>
                            <li><code>seasonal_reforecast / ss_refcast</code></li>
                            <li><code>decadal_forecast_initialization / dc_fcast_init</code></li>
                            <li><code>decadal_forecast / dc_fcast</code></li>
                            <li><code>long_term_projection / ltm_proj</code></li>
                            <li>…etc</li>
                          </ul>
                        </li>
                        
                        <li>
                          <code> &ltoutput_frequency&gt </code>:
  
                          [directory name / filename abbreviation]
    
                          <ul>
                            <li><code>yearly / yearly</code></li>
                            <li><code>monthly / monthly</code></li>
                            <li><code>daily / daily</code></li>
                          </ul>
                        </li>
  
                        <li>
                          <code> &ltgrid_type&gt </code>:
  
                          [directory name / filename abbreviation]
    
                          <ul>
                            <li><code>raw / raw</code></li>
                            <li><code>regrid / regrid</code></li>
                          </ul>
                        </li>
                        
                        <li>
                          <code> &ltrelease&gt </code>:
  
                          <ul>
                            <li><code>rYYYY0M0D ex: r20230401</code></li>
                          </ul>
                        </li>
                        
                      </ul>
                    </p>
                </div>
            </div>
        </div>
        <!-- expanding panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
              <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
              <i class="fas fa-plus-circle"></i> CEFI filename structure</a>
              </h4>
          </div>

          <div id="collapse1" class="panel-collapse collapse">
              <div class="panel-body">
                <p>
                  The CEFI filename structure is designed to clearly distinguish between different experiment types.
                  It follows a hierarchical format that preserves the directory structure, preventing overwrites from separate experiments or downloads within the same directory.
                </p>
                <hr class="dot-hr-plot">

                <h3> Hindcast </h3>
                
                <p>
                  The file contains a single variable for the entire run period in one consolidated file. The filename follows this format:
                </p>
                  
                <pre><code class="codeBlockScroll">variable_name.region.subdomain.experiment_type.output_frequency.grid_type.rYYYYMMDD.YYYY0M-YYYY0M.nc</code></pre>

                <p>
                  example includes:
                  <ul>
                    <li>
                      <code> btm_o2.nwa.full.hcast.daily.raw.r20230401.199301-201912.nc </code>
                    </li>
                    <li>
                      <code> rhopot0.nwa.gomex.hcast.monthly.raw.r20230401.199301-201912.nc </code>
                    </li>
                  </ul>
                </p>


                <hr class="dot-hr-plot">

                <h3> Season and decadal forecast (re-forecast) </h3>
                
                <p>
                  A single file contains data for one initialization (<code>iYYYY0M</code>-initialized year [YYYY] and month [0M]), capturing all ensemble members and lead times for a single variable. The filename follows this format:
                </p>
                  
                <pre><code class="codeBlockScroll">variable_name.region.subdomain.experiment_type.output_frequency.grid_type.rYYYYMMDD.ensemble_info.iYYYY0M</code></pre>

                <p>
                  example includes:
                  <ul>
                    <li>
                      <code> tos.nwa.gomex.ss_fcast.monthly.raw.r20230401.enss.i202212.nc </code>
                    </li>
                    <li>
                      <code> thetao.nep.full.ss_fcast_init.monthly.raw.r20230401.ens_stats.i199303.nc </code>
                    </li>
                    <li>
                      <code> thetao.nep.full.ss_refcast.monthly.raw.r20230401.ens_stats.i199303.nc </code>
                    </li>
                    <li>
                      <code> thetao.nep.full.dc_fcast.monthly.raw.r20230401.ens0.i199303.nc </code>
                    </li>
                  </ul>
                </p>

                <hr class="dot-hr-plot">

                <h3> Long-term projection </h3>
                
                <p>
                  A single file contains data for one scenario, capturing all ensemble members for a single variable. The filename follows this format:
                </p>
                  
                <pre><code class="codeBlockScroll">variable_name.region.subdomain.experiment_type.output_frequency.grid_type.rYYYYMMDD.picontrol/historical/proj_forcing.ensemble_info.YYYY0M-YYYY0M</code></pre>

                <p>
                  example includes:
                  <ul>
                    <li>
                      <code> tos.nwa.full.ltm_proj.yearly.raw.r20230401.proj_ssp370.enss.202001-209912.nc</code>
                    </li>
                    <li>
                      <code> tos.nwa.full.ltm_proj.yearly.raw.r20230401.proj_ssp585.enss.202001-209912.nc</code>
                    </li>
                    <li>
                      <code> tos.nwa.full.ltm_proj.monthly.raw.r20230401.picontrol.enss.185001-201912.nc </code>
                    </li>
                    <li>
                      <code> tos.nwa.full.ltm_proj.monthly.raw.r20230401.hist.enss.185001-201912.nc </code>
                    </li>
                  </ul>
                </p>

              </div>
          </div>
        </div>
        <!-- expanding panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
              <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
              <i class="fas fa-plus-circle"></i> CEFI netCDF file global attributes</a>
              </h4>
          </div>

          <div id="collapse2" class="panel-collapse collapse">
              <div class="panel-body">
                <p>
                  Each netCDF file served by the CEFI portal includes global attributes. 
                  These attributes provide comprehensive information about the data structure, filename segments, and DOIs for both the dataset and related papers. 
                  All CEFI-specific attributes are prefixed with <code>cefi_</code>
                </p>
                <hr class="dot-hr-plot">
                <p>
                  A list of all CEFI-related global attributes is provided below as an example, using a hindcast experiment.
                  <pre>
                    <code class="attr">
:cefi_rel_path = "cefi_portal/northwest_atlantic/full_domain/hindcast/daily/raw/r20230519"
:cefi_filename = "tos.nwa.full.hcast.daily.raw.r20230519.199301-201912.nc"
:cefi_variable = "tos"
:cefi_ori_filename = "ocean_daily.19930101-20191231.tos.nc"
:cefi_archive_version = "/archive/acr/fre/NWA/2023_04/NWA12_COBALT_2023_04_kpo4-coastatten-physics/gfdl.ncrc5-intel22-prod"
:cefi_run_xml = "N/A"
:cefi_region = "nwa"
:cefi_subdomain = "full"
:cefi_experiment_type = "hindcast"
:cefi_experiment_name = "nwa12_cobalt"
:cefi_release = "r20230519"
:cefi_output_frequency = "daily"
:cefi_grid_type = "raw"
:cefi_date_range = "199301-201912"
:cefi_init_date = "N/A"
:cefi_ensemble_info = "N/A"
:cefi_forcing = "N/A"
:cefi_data_doi = "10.5281/zenodo.7893386"
:cefi_paper_doi = "10.5194/gmd-16-6943-2023"
:cefi_aux = "N/A"
                    </code>
                  </pre>
                </p>

              </div>
          </div>
        </div>
    </div>
</div>

<hr class="dot-hr-plot">

<div class = "row">
  <h3>Variable Lists</h3>
  <div class="userInput col-12">
    <!-- <h1 class="userInputTitle"><em>Regions</em></h1> -->
    <!-- The Radio group for different region queries -->
    <input type="radio" class="radioDataTable" id="radioNWATable" name="dataTableOptions" checked>
    <label for="radioNWATable">Northwest Atlantic</label>
    <input type="radio" class="radioDataTable" id="radioNEPTable" name="dataTableOptions">
    <label for="radioNEPTable">Northeast Pacific</label>
    <br>
    <br>
    <ul class="nwaTableOpt">
      <li>
        Hindcast:
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.hindcast.html" target="_blank">HTML view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.hindcast.json" target="_blank">JSON view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.hindcast.xml" target="_blank">XML view</a>
      </li>
      <li>
        Reforecast:
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.seasonal_reforecast.html" target="_blank">HTML view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.seasonal_reforecast.json" target="_blank">JSON view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.seasonal_reforecast.xml" target="_blank">XML view</a>
      </li>
      <li>
        Forecast:
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.seasonal_forecast.html" target="_blank">HTML view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.seasonal_forecast.json" target="_blank">JSON view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northwest_atlantic.full_domain.seasonal_forecast.xml" target="_blank">XML view</a>
      </li>
    </ul>
    <ul class="nepTableOpt hidden">
      <li>
        Hindcast:
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northeast_pacific.full_domain.hindcast.html" target="_blank">HTML view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northeast_pacific.full_domain.hindcast.json" target="_blank">JSON view</a>,
        <a href="data_index/cefi_data_indexing.Projects.CEFI.regional_mom6.cefi_portal.northeast_pacific.full_domain.hindcast.xml" target="_blank">XML view</a>
      </li>
    </ul>
  </div>
  <br>
</div>  
      
<hr class="dot-hr-plot">

<div class = "row">
  <h3>Data Query Generator</h3>
  <p>
    The data query generator is designed to swiftly generate command line code or code snippets, facilitating user access to the data.
    It is recommended to use the OPeNDAP server for querying data when only a subset is required.
    However, if there is a need to download the entire dataset, please pick the download tab for the wget command and button click download.
    The query generator also provides the data citation doi depending on different region and version of dataset.
  </p>
  

  <div class="userInput col-12">
    <h1 class="userInputTitle"><em>Data Options</em></h1>
    <!-- region and subdomain radio button should be created seperately -->
    <input type="radio" class="radioDataQuery" id="radioNWAQuery" name="dataQueryOptions" value="northwest_atlantic" checked>
    <label for="radioNWAQuery">Northwest Atlantic</label>
    <input type="radio" class="radioDataQuery" id="radioNEPQuery" name="dataQueryOptions" value="northeast_pacific">
    <label for="radioNEPQuery">Northeast Pacific</label>
    <br>
    <br>

    <table class="rowGap">
        <tr>
          <td>Experiment Types : </td>
          <td>
              <select id="expTypeDataQuery"></select>
          </td>
        </tr>
        <tr>
          <td>Output Frequencies : </td>
          <td>
              <select id="outFreqDataQuery">
                <!-- <option class="default-option" selected disabled>Select an output frequency</option> -->
              </select>
          </td>
        </tr>
        <tr>
          <td>Grid Types : </td>
          <td>
              <select id="gridTypeDataQuery">
                <!-- <option class="default-option" selected disabled>Select a grid type</option> -->
              </select>
          </td>
        </tr>
        <tr>
          <td>Releases : </td>
          <td>
              <select id="releaseDataQuery">
                <!-- <option class="default-option" selected disabled>Select a release date</option> -->
              </select>
          </td>
        </tr>
        <tr>
          <td>Variables : </td>
          <td>
              <select id="variableDataQuery">
                <!-- <option class="default-option" selected disabled>Select a variable</option> -->
              </select>
          </td>
        </tr>

        <tr class="forecastOpt hidden">
          <td>Initial Dates : </td>
          <td>
              <select class="default-option" id="initialDateFcastDataQuery">Select initialization date (iYYYYMM)</select>
          </td>
        </tr>
        <tr class="forecastOpt hidden">
          <td>Ensemble Options : </td>
          <td>
              <select class="default-option" id="ensOptionFcastDataQuery">Select ensemble options</select>
          </td>
        </tr>

        <tr class="projectOpt hidden">
          <td>Scenarios : </td>
          <td>
              <select class="default-option" id="scenarioProjDataQuery">Select scenario</select>
          </td>
        </tr>
        <tr class="projectOpt hidden">
          <td>Ensemble Options : </td>
          <td>
              <select class="default-option" id="ensOptionProjDataQuery">Select ensemble options</select>
          </td>
        </tr>

    </table>
    <hr class="dot-hr-plot">
    <button id="genQueryButton" class="btn btn-psl">Generate Queries</button>
  </div>
</div>
<br> 

<!-- creating the tab under bootstrap tab using navpil -->
<div class="row" id="dashNavDataAcess">
  <ul class="nav nav-pills nav-justified hidden-xs" id="pills-data">
      <li class="nav-item active" id="opendapPill">
          <a class="nav-link" href="#opendapView" data-toggle="tab" aria-expanded="true">OPeNDAP</a>
      </li>
      <li class="nav-item" id="downloadPill">
          <a class="nav-link" href="#downloadView" data-toggle="tab" aria-expanded="true">Download netCDF</a>
      </li>
      <li class="nav-item" id="citationPill">
          <a class="nav-link" href="#citationView" data-toggle="tab" aria-expanded="true">Data Citation</a>
      </li>
  </ul>
  <ul class="nav nav-tabs nav-justified visible-xs" id="tabs-data">
      <li class="nav-item active" id="opendapViewTab">
          <a class="nav-link" href="#opendapView" data-toggle="tab" aria-expanded="false">OPeNDAP</a>
      </li>
      <li class="nav-item" id="downloadViewTab">
          <a class="nav-link" href="#downloadView" data-toggle="tab" aria-expanded="false">Download netCDF</a>
      </li>
      <li class="nav-item" id="citationViewTab">
          <a class="nav-link" href="#citationView" data-toggle="tab" aria-expanded="false">Data Citation</a>
      </li>
  </ul>
</div>

<div class="row" id="dashContentDataAcess">
  <div class="tab-content">
      <!-- opendap pill -->
      <div id='opendapView' class="tab-pane active view col-12">
        <!-- URL -->
        <h4><strong>OPeNDAP URL</strong></h4>
        <p>
            Using OPeNDAP can subset the data to a smaller region or time frame.
            The OPeNDAP server has a <strong>500MB</strong> limit per request.
            A loop is suggested to load data that is larger than 500 MB.
        </p>
        <pre id="codeBlockOpendap"><code class="codeBlockScroll">Please generate query first!</code></pre> 
        <button id="copyButtonOpendap" class="btn btn-psl">Copy OPeNDAP URL</button>
        <hr class="dot-hr-plot">
        <!-- Python code -->
        <h4><strong>OPeNDAP (Python)</strong></h4>
            <p> 
                Please follow the 
                <a href="https://noaa-cefi-portal.github.io/cefi-cookbook/content/how_to_conda.html" target="_blank">
                  <strong>environment setup</strong>
                </a>
                for the following Python code to work. 
                <a href="https://noaa-cefi-portal.github.io/cefi-cookbook/content/data_access/access_opendap/python_get_cefi.html" target="_blank">
                  <strong>A comprehensive tutorial (Python) can be found here</strong>
                </a>
            </p>
        <pre id="codeBlockPython"><code class="codeBlockScroll">Please generate query first!</code></pre> 
        <button id="copyButtonPython" class="btn btn-psl">Copy Python Code</button>
        <hr class="dot-hr-plot">
        <!-- R code -->
        <h4><strong>OPeNDAP (R)</strong></h4>
            <p>
                Please follow the 
                <a href="https://noaa-cefi-portal.github.io/cefi-cookbook/content/how_to_conda.html" target="_blank">
                  <strong>environment setup</strong>
                </a>
                for the following R code to work. 
                <a href="https://noaa-cefi-portal.github.io/cefi-cookbook/content/data_access/access_opendap/r_get_cefi.html" target="_blank">
                  <strong>A comprehensive tutorial (R) can be found here</strong>
                </a>
            </p>
        <pre id="codeBlockR"><code class="codeBlockScroll">Please generate query first!</code></pre> 
        <button id="copyButtonR" class="btn btn-psl">Copy R Code</button>            
        <hr class="dot-hr-plot">
      </div>      

      <!-- netcdf download pill -->
      <div id='downloadView' class="tab-pane view col-12">
        <!-- button download -->
        <h4><strong>Direct download</strong></h4>
        <pre id="codeBlockDataInfo"><code class="codeBlockScroll">Please generate query first!</code></pre> 
        <a id="downloadHttp">
          <button id="downloadButton" class="btn btn-psl">Download netCDF</button>
        </a>
        <hr class="dot-hr-plot">
        <!-- Wget -->
        <h4><strong>Wget (Unix/Linux terminal command)</strong></h4>
        <pre id="codeBlockWget"><code class="codeBlockScroll">Please generate query first!</code></pre> 
        <button id="copyButtonWget" class="btn btn-psl">Copy Wget Code</button>
        <hr class="dot-hr-plot">
      </div>

      <!-- data citation pill -->
      <div id='citationView' class="tab-pane view col-12">
        <h4><strong>Citations</strong></h4>
        <pre id="codeBlockCite"><code class="codeBlockScroll">Please generate query first!</code></pre> 
        <button id="copyButtonCite" class="btn btn-psl">Copy Citation</button>
        <hr class="dot-hr-plot">
      </div>  
  </div>
</div>

<br>

<div class="alert alert-info" role="alert">
  &#10024; If you have any questions or feedback, please feel free to contact us via <a href="#" class="alert-link" data-toggle="modal" data-target="#Modalfeedback">google form</a>! &#10024;
</div>


<!-- Modal Feedback form -->
<div class="modal fade" id="ModalVariableRequest" tabindex="-1" role="dialog" aria-labelledby="ModalVariableRequest_title" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="ModalVariableRequest_title">Requesting Variables</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <iframe class="variable-form" src="https://forms.gle/9Nzf3cc2u7tR1ZTz7" scrolling=no frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>